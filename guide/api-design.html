<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>API | Okta Multi Tenant Admin</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="Identity Management for Multi-Tenant Applications">
    <link rel="preload" href="/assets/css/0.styles.647b89b9.css" as="style"><link rel="preload" href="/assets/js/app.450515ec.js" as="script"><link rel="preload" href="/assets/js/2.7119a548.js" as="script"><link rel="preload" href="/assets/js/11.2e3204a8.js" as="script"><link rel="prefetch" href="/assets/js/10.6f6f30df.js"><link rel="prefetch" href="/assets/js/12.71d99b0e.js"><link rel="prefetch" href="/assets/js/13.8760065f.js"><link rel="prefetch" href="/assets/js/14.4f1def24.js"><link rel="prefetch" href="/assets/js/15.9fb2c3c4.js"><link rel="prefetch" href="/assets/js/3.eed724d4.js"><link rel="prefetch" href="/assets/js/4.4123bd0c.js"><link rel="prefetch" href="/assets/js/5.8f22c7be.js"><link rel="prefetch" href="/assets/js/6.33805e7e.js"><link rel="prefetch" href="/assets/js/7.3fc291a8.js"><link rel="prefetch" href="/assets/js/8.6ba0f06d.js"><link rel="prefetch" href="/assets/js/9.18c1fe6e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.647b89b9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://www.okta.com/sites/all/themes/Okta/images/logos/developer/Dev_Logo-02_Large.png" alt="Okta Multi Tenant Admin" class="logo"> <span class="site-name can-hide">Okta Multi Tenant Admin</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link router-link-active">
  Guide
</a></div><div class="nav-item"><a href="/setup/" class="nav-link">
  Setup
</a></div><div class="nav-item"><a href="/api/" class="nav-link">
  API Reference
</a></div> <a href="https://github.com/oktadeveloper/okta-dac" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link router-link-active">
  Guide
</a></div><div class="nav-item"><a href="/setup/" class="nav-link">
  Setup
</a></div><div class="nav-item"><a href="/api/" class="nav-link">
  API Reference
</a></div> <a href="https://github.com/oktadeveloper/okta-dac" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Guide</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/" aria-current="page" class="sidebar-link">Concepts and Use Cases</a></li><li><a href="/guide/architecture.html" class="sidebar-link">Architecture</a></li><li><a href="/guide/api-design.html" aria-current="page" class="active sidebar-link">API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/api-design.html#oauth-for-okta" class="sidebar-link">OAuth for Okta</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/api-design.html#okta-session" class="sidebar-link">Okta session</a></li></ul></li><li class="sidebar-sub-header"><a href="/guide/api-design.html#api-access-management" class="sidebar-link">API Access Management</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/api-design.html#the-tenants-claim" class="sidebar-link">The tenants claim</a></li><li class="sidebar-sub-header"><a href="/guide/api-design.html#the-groups-claim" class="sidebar-link">The groups claim</a></li><li class="sidebar-sub-header"><a href="/guide/api-design.html#authz" class="sidebar-link">AuthZ</a></li></ul></li><li class="sidebar-sub-header"><a href="/guide/api-design.html#okta-dac-composite-apis" class="sidebar-link">okta-dac Composite APIs</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/api-design.html#tenants-api" class="sidebar-link">Tenants API</a></li><li class="sidebar-sub-header"><a href="/guide/api-design.html#idps-api" class="sidebar-link">IdPs API</a></li><li class="sidebar-sub-header"><a href="/guide/api-design.html#apps-api" class="sidebar-link">Apps API</a></li><li class="sidebar-sub-header"><a href="/guide/api-design.html#custom-authorizer" class="sidebar-link">Custom Authorizer</a></li></ul></li><li class="sidebar-sub-header"><a href="/guide/api-design.html#next-steps" class="sidebar-link">Next Steps</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="api"><a href="#api" class="header-anchor">#</a> API</h1> <p>This section discusses the design for okta-dac <a href="/api">APIs</a>.</p> <h2 id="oauth-for-okta"><a href="#oauth-for-okta" class="header-anchor">#</a> OAuth for Okta</h2> <p>With <a href="https://developer.okta.com/docs/guides/implement-oauth-for-okta/overview/" target="_blank" rel="noopener noreferrer">OAuth for Okta<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, you are able to interact with Okta APIs using scoped OAuth 2.0 access tokens. Each access token enables the bearer to perform specific actions on specific Okta endpoints, with that ability controlled by which scopes the access token contains.</p> <p>The <a href="https://developer.okta.com/docs/guides/implement-oauth-for-okta/scopes/" target="_blank" rel="noopener noreferrer">scopes<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> that we request are:</p> <ul><li><code>okta.users.manage</code> so that we can read, add, and update users</li> <li><code>okta.groups.manage</code> so that we can read and update groups</li></ul> <p><em><strong>If you are a Group Admin and obtain an access_token from Okta with the above scopes, you can use it on the <a href="https://developer.okta.com/docs/reference/api/users/" target="_blank" rel="noopener noreferrer">users<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and <a href="https://developer.okta.com/docs/reference/api/groups/" target="_blank" rel="noopener noreferrer">groups<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> APIs. Most importantly, the API responses are automatically filtered according to your Group Admin privileges.</strong></em> For example, calling <code>GET /users</code> will return only users in the groups you manage; Calling <code>GET /groups</code> will only return groups you manage, etc.</p> <p>In order to get an access_token with these scopes, we rely on the Okta session.</p> <h3 id="okta-session"><a href="#okta-session" class="header-anchor">#</a> Okta session</h3> <p>Okta uses a cookie-based authentication mechanism to maintain a user's authentication <a href="https://developer.okta.com/docs/reference/api/sessions/" target="_blank" rel="noopener noreferrer">session<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> across web requests.</p> <ul><li>When a user signs into okta-dac, a session is created in Okta and persisted on the browser with a cookie.</li> <li>Leveraging this existing session, we can then <strong>fetch the bearer token</strong> without the need to re-authenticate. We use the <a href="https://github.com/okta/okta-auth-js" target="_blank" rel="noopener noreferrer">Okta Auth JavaScript SDK<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <code>getWithoutPrompt</code> function to silently get this token. Below is the sample code:</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//src/views/Home.vue</span>
<span class="token keyword">const</span> authJs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AuthJS</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    issuer<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$config<span class="token punctuation">.</span>oidc<span class="token punctuation">.</span>issuer<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;oauth2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    clientId<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$config<span class="token punctuation">.</span>oidc<span class="token punctuation">.</span>client_id<span class="token punctuation">,</span>
    redirectUri<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$config<span class="token punctuation">.</span>oidc<span class="token punctuation">.</span>redirect_uri<span class="token punctuation">,</span>
    pkce<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> exists <span class="token operator">=</span> <span class="token keyword">await</span> authJs<span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>exists<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> authJs<span class="token punctuation">.</span>token<span class="token punctuation">.</span><span class="token function">getWithoutPrompt</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            scopes<span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">&quot;okta.users.manage&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;okta.groups.manage&quot;</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> accessToken <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">token</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> token<span class="token punctuation">.</span>accessToken<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token comment">// vuex</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">&quot;setO4oToken&quot;</span><span class="token punctuation">,</span> accessToken<span class="token punctuation">.</span>accessToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">mutation<span class="token punctuation">,</span> state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Got mutation&quot;</span><span class="token punctuation">,</span> mutation<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><a href="https://github.com/okta/okta-auth-js#sessionexists" target="_blank" rel="noopener noreferrer"><code>authJs.session.exists()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> checks to see if user has logged-in (i.e. an Okta session exists)</li> <li><a href="https://github.com/okta/okta-auth-js#tokengetwithoutpromptoptions" target="_blank" rel="noopener noreferrer"><code>authJs.token.getWithoutPrompt()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> makes an OAuth <a href="https://developer.okta.com/docs/reference/api/oidc/#authorize" target="_blank" rel="noopener noreferrer">authorize<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> request with <a href="https://developer.okta.com/docs/reference/api/oidc/#parameter-details" target="_blank" rel="noopener noreferrer"><code>&amp;prompt=none</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. As a session cookie is present in the request, the user does not need to authenticate again.</li></ul> <p>In okta-dac, a good place to run this piece of code is in <code>src/views/Home.vue</code>, during the on created event. This is because upon logging into okta-dac, the first component we land on is Home.vue.</p> <p>Once we get the access_token we use it to implement list/search users, add users, update users, assign apps, etc.</p> <p><img src="/assets/img/dac-demo.3704e1e4.gif" alt="alt text"></p> <h2 id="api-access-management"><a href="#api-access-management" class="header-anchor">#</a> API Access Management</h2> <p>Because we synthetically created a Tenants structure in the Okta org, we need to write our own <a href="/api/#tenants">Tenants API</a> to wrap around the Okta CRUD APIs and perform custom filtering of the CRUD API's results.</p> <p>Over here, we leverage <a href="https://developer.okta.com/docs/concepts/api-access-management/" target="_blank" rel="noopener noreferrer">API Access Management<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> – Okta's implementation of the OAuth 2.0 standard – to secure our &quot;wrapper APIs&quot;, which implement the business logic abstraction layer that generates our &quot;tenant&quot; structure in the Okta org. (Please refer to <a href="/api/#composite-apis">composite APIs</a> for documentation).</p> <p><strong>Couple of custom claims are essential to the proper functioning of okta-dac. Okta's API Access Management makes it easy to generate JWTs and embed custom claims:</strong></p> <h3 id="the-tenants-claim"><a href="#the-tenants-claim" class="header-anchor">#</a> The <code>tenants</code> claim</h3> <div class="custom-block warning"><p class="custom-block-title">NOTE</p> <p>The <code>APPLICATION_ENTITLEMENT_POLICY</code> <strong>feature flag</strong> must be enabled for the Okta Org</p></div> <p>We configure Okta to store a User App Attribute called &quot;Tenants&quot; and display its value in a custom claim called <code>tenants</code>. See:</p> <ul><li>Custom App Profile Attribute. <a href="/setup/org-setup.html#_4-add-custom-app-profile-attribute">Config steps</a>.</li> <li>The <code>tenants</code> custom claim. <a href="/setup/org-setup.html#_6-add-custom-claims">Config steps</a>.</li></ul> <p>We populate <code>tenants</code> using a special format: <code>${tenantId}:${tenantName}:${usersGroupId}</code>. This is done inside our <a href="/api/#add-tenant">Add Tenant</a> API code by calling <em><strong><code>PUT</code></strong><code>apps/${appId}/groups/${groupId}</code></em> to update the AppProfile.</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>
    orgUrl <span class="token operator">+</span> <span class="token string">'/api/v1/apps/'</span> <span class="token operator">+</span> clientId <span class="token operator">+</span> <span class="token string">'/groups/'</span> <span class="token operator">+</span> groupId<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        profile<span class="token operator">:</span> <span class="token punctuation">{</span>
            tenants<span class="token operator">:</span> <span class="token punctuation">[</span>
                tenantId <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> tenantName <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> usersGroupId
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    headers
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Embedding this value in the JWT provides okta-dac quick access to the tenant name and id, and its associated USERS_ group id without making additional requests to the Okta API.</p> <h3 id="the-groups-claim"><a href="#the-groups-claim" class="header-anchor">#</a> The <code>groups</code> claim</h3> <p>We configure Okta to return the <code>groups</code> custom claim. See <a href="/setup/org-setup.html#_6-add-custom-claims">steps</a>. This allows the okta-dac to:</p> <ul><li>Differentiate Super Admins from Tenant Admins.</li> <li>For the Tenant Admins, provide the Tenant(s) info.</li> <li>Which apps are available for Tenants.</li></ul> <h4 id="sample-jwt"><a href="#sample-jwt" class="header-anchor">#</a> Sample JWT</h4> <p>As mentioned, the <code>tenants</code> and <code>groups</code> claims are crucial for the proper functioning of okta-dac. To illustrate how they're used, take a look at the sample below:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;sub&quot;</span><span class="token operator">:</span> <span class="token string">&quot;00upkrte35fGaTMJi0h7&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;ver&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">&quot;iss&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://byobrand.oktapreview.com/oauth2/default&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;aud&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0oaph3ep6uKllifkG0h7&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;iat&quot;</span><span class="token operator">:</span> <span class="token number">1588116050</span><span class="token punctuation">,</span>
  <span class="token property">&quot;exp&quot;</span><span class="token operator">:</span> <span class="token number">1588119650</span><span class="token punctuation">,</span>
  <span class="token property">&quot;jti&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ID.9bXZ7w_fzcl0vR3oSTGpBWPRl6X7220uJ_3ciqpYfoY&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;amr&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;pwd&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;idp&quot;</span><span class="token operator">:</span> <span class="token string">&quot;00op8q9xatOpYa5MK0h7&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;nonce&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nonce&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;auth_time&quot;</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
  <span class="token property">&quot;at_hash&quot;</span><span class="token operator">:</span> <span class="token string">&quot;preview_at_hash&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;tenants&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;0oapi0vtwxmVdOywi0h7:spidermonkey:00gpi18cf4SkPByz40h7&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;groups&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;USERS_spidermonkey&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;Everyone&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;ADMINS_spidermonkey&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;APPUSERS_spidermonkey_0oaq1xvxlfoEEbii40h7&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;APPUSERS_spidermonkey_0oaphr8z83xlSeZAg0h7&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>This JWT is for a Tenant Admin because there is no SUPERUSERS in the <code>groups</code> claim</li> <li>The Tenant is &quot;spidermonkey&quot;</li> <li>spidermonkey has access to 2 apps (Ids <code>0oaq1xvxlfoEEbii40h7</code> &amp; <code>0oaphr8z83xlSeZAg0h7</code>)</li></ul> <h3 id="authz"><a href="#authz" class="header-anchor">#</a> AuthZ</h3> <p>The information in the above JWT is used by okta-dac to display the proper UX to the user. Not only that, it is also used to authorize access for our wrapper APIs. See <a href="#custom-authorizer">custom-authorizer</a> for more info.</p> <h2 id="okta-dac-composite-apis"><a href="#okta-dac-composite-apis" class="header-anchor">#</a> okta-dac Composite APIs</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Refer to the <a href="https://github.com/oktadeveloper/okta-dac-api" target="_blank" rel="noopener noreferrer">okta-dac-api<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> serverless project for source code and issue tracking.</p></div> <h3 id="tenants-api"><a href="#tenants-api" class="header-anchor">#</a> <a href="/api/#tenants">Tenants API</a></h3> <p>Implementing the Tenants endpoint is a practice of stitching together a series of Okta API operations. We illustrate with a few examples:</p> <ul><li><p><strong>Example 1</strong>:
When we <a href="/api/#add-tenant">add a tenant</a>, what the client sees as one API call is actually 8 API requests:</p> <ol><li><a href="https://developer.okta.com/docs/reference/api/idps/#add-identity-provider" target="_blank" rel="noopener noreferrer">Add Identity Provider<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> with naming convention <code>DAC_${tenantName}</code></li> <li><a href="https://developer.okta.com/docs/reference/api/groups/#add-group" target="_blank" rel="noopener noreferrer">Add <code>USERS_${tenantName}</code> group<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>Add <code>ADMINS_${tenantName}</code>. Set <code>profile.description</code>=</li></ol> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;tenantId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;${id-from-step-#1}&quot;</span><span class="token punctuation">}</span>
</code></pre></div><ol start="4"><li><a href="https://developer.okta.com/docs/reference/api/roles/#assign-a-role-to-a-group" target="_blank" rel="noopener noreferrer">Add a Role<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <code>type==USER_ADMIN</code> to the <code>ADMINS_${tenantName}</code> group.</li> <li><a href="https://developer.okta.com/docs/reference/api/roles/#add-group-target-to-group-administrator-role-given-to-a-group" target="_blank" rel="noopener noreferrer">Assign <code>USERS_${tenantName}</code> role target<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to the GroupRole from step #4.</li> <li>Assign <code>ADMINS_${tenantName}</code> role target the GroupRole from step #4.</li> <li><a href="https://developer.okta.com/docs/reference/api/apps/#assign-group-to-application" target="_blank" rel="noopener noreferrer">Assign the <code>USERS_${tenantName}</code> group<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to the okta-dac App</li> <li><a href="https://developer.okta.com/docs/reference/api/idps/#update-identity-provider" target="_blank" rel="noopener noreferrer">Update IdP<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> from step #1 and set JIT to group = <code>USERS_${tenantName}</code>.</li></ol></li> <li><p><strong>Example 2</strong>: When we <a href="/api/#get-tenant">get a tenant</a> by name, we call the <a href="https://developer.okta.com/docs/reference/api/groups/#search-groups" target="_blank" rel="noopener noreferrer">Search Groups<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> API. This is because every tenant has an equivalent <code>ADMINS_${tenantName}</code> group and there is no search IdPs API.</p></li> <li><p><strong>Example 3</strong>: <a href="/api/#tenant-apps">Tenant Apps</a></p> <ul><li>When we &quot;add tenant app&quot;, we create a <code>APPUSERS_${tenantName}_${appId}</code> group.</li> <li>When we &quot;list tenant apps&quot;, we search groups using the parameter <code>q=APPUSERS_${tenantName}</code></li></ul></li> <li><p><strong>Example 4</strong>: <a href="/api/#tenant-admins">Tenant Admins</a></p> <ul><li>When we &quot;list tenant admins&quot;, we return all users for the group <code>ADMINS_${tenantName}</code>.</li> <li>When we &quot;assign tenant admin&quot;, we add a user to the <code>ADMINS_${tenantName}</code> group.</li></ul></li> <li><p><strong>Example 5</strong>: <a href="/api/#tenant-domains">Tenant Domains</a></p> <ul><li>When we &quot;add a tenant domain&quot;, we add a routing rule (or update an existing routing rule)</li> <li>When we &quot;list domains for a tenant&quot;, we lookup the routing rule and (if exists) list all of its domains</li></ul></li></ul> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>Refer to the source code for implementation details</p></div> <h3 id="idps-api"><a href="#idps-api" class="header-anchor">#</a> <a href="/api/#idps">IdPs API</a></h3> <p>Keep in mind that we store the IdP Id in the <code>ADMINS_${tenantName}</code> group's <code>profile.description</code> as the &quot;tenantId&quot;:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;tenantId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;${id-from-step-#1}&quot;</span><span class="token punctuation">}</span>
</code></pre></div><p>This allows us to implement the <a href="/api/#get-idp">Get Idp</a> composite API:</p> <ol><li>Search Groups with <code>q=ADMINS_${tenantName}</code></li> <li>Parse the <code>profile.description</code> for the &quot;tenantId&quot;</li> <li>Read back the Idp (by Id) from step #2</li></ol> <p>Similarly, <a href="/api/#update-idp">Update Idp</a> triggers:</p> <ol><li>Search Groups with <code>q=ADMINS_${tenantName}</code></li> <li>Parse the <code>profile.description</code> for the &quot;tenantId&quot;</li> <li>Update Idp (by Id) from step #2</li></ol> <h3 id="apps-api"><a href="#apps-api" class="header-anchor">#</a> <a href="/api/#apps">Apps API</a></h3> <p>We implemented a <a href="/api/#list-apps">List Apps</a> API which is context sensitive to the Bearer token of the request. If the token's <code>groups</code> claim contains <code>SUPERUSERS</code>, then list all apps that <strong>startsWith</strong> <code>DAC_</code>. Else, list all apps that <strong>startswith</strong> <code>APPUSERS_${tenantName}</code>. For implementation details refer to the project source code.</p> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>To distinguish between SaaS provider products/apps and other apps in Okta, we simply prefix them with <code>DAC_</code></p></div> <h3 id="custom-authorizer"><a href="#custom-authorizer" class="header-anchor">#</a> Custom Authorizer</h3> <p>Amazon API Gateway supports custom authorizers where you can restrict access to the exact HTTP method and route. We rely heavily on this functionality to provide AuthZ functionality to our composite APIs.</p> <p>In the custom authorizer, we restrict access to the tenant-namespaced route based on which tenant the user is an ADMIN of. Keep in mind that our JWT contains the <code>tenants</code> and <code>groups</code> claims, which give us the AuthZ information that we need to generate the following policy:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Everyone can read apps</span>
policy<span class="token punctuation">.</span><span class="token function">allowMethod</span><span class="token punctuation">(</span>AuthPolicy<span class="token punctuation">.</span>HttpVerb<span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">,</span> <span class="token string">'apps'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
policy<span class="token punctuation">.</span><span class="token function">allowMethod</span><span class="token punctuation">(</span>AuthPolicy<span class="token punctuation">.</span>HttpVerb<span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">,</span> <span class="token string">'apps/*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Only superusers can read and add tenants</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>jwt<span class="token punctuation">.</span>claims<span class="token punctuation">.</span>groups <span class="token operator">&amp;&amp;</span> jwt<span class="token punctuation">.</span>claims<span class="token punctuation">.</span>groups<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'SUPERUSERS'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    policy<span class="token punctuation">.</span><span class="token function">allowMethod</span><span class="token punctuation">(</span>AuthPolicy<span class="token punctuation">.</span>HttpVerb<span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">,</span> <span class="token string">'tenants'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    policy<span class="token punctuation">.</span><span class="token function">allowMethod</span><span class="token punctuation">(</span>AuthPolicy<span class="token punctuation">.</span>HttpVerb<span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">,</span> <span class="token string">'tenants'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    policy<span class="token punctuation">.</span><span class="token function">allowMethod</span><span class="token punctuation">(</span>AuthPolicy<span class="token punctuation">.</span>HttpVerb<span class="token punctuation">.</span><span class="token constant">ALL</span><span class="token punctuation">,</span> <span class="token string">'tenants/*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> tenants <span class="token operator">=</span> jwt<span class="token punctuation">.</span>claims<span class="token punctuation">.</span>tenants<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>tenants <span class="token operator">&amp;&amp;</span> tenants<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    policy<span class="token punctuation">.</span><span class="token function">allowMethod</span><span class="token punctuation">(</span>AuthPolicy<span class="token punctuation">.</span>HttpVerb<span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">,</span> <span class="token string">'idps'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tenants<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">tenant</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> parts <span class="token operator">=</span> tenant<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Tenant Admins can read and update their own idp settings</span>
        policy<span class="token punctuation">.</span><span class="token function">allowMethod</span><span class="token punctuation">(</span>AuthPolicy<span class="token punctuation">.</span>HttpVerb<span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">,</span> <span class="token string">'idps/'</span> <span class="token operator">+</span> parts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        policy<span class="token punctuation">.</span><span class="token function">allowMethod</span><span class="token punctuation">(</span>AuthPolicy<span class="token punctuation">.</span>HttpVerb<span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">,</span> <span class="token string">'idps/'</span> <span class="token operator">+</span> parts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'/metadata.xml'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        policy<span class="token punctuation">.</span><span class="token function">allowMethod</span><span class="token punctuation">(</span>AuthPolicy<span class="token punctuation">.</span>HttpVerb<span class="token punctuation">.</span><span class="token constant">PUT</span><span class="token punctuation">,</span> <span class="token string">'idps/'</span> <span class="token operator">+</span> parts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   

        <span class="token comment">// Read own tenants</span>
        policy<span class="token punctuation">.</span><span class="token function">allowMethod</span><span class="token punctuation">(</span>AuthPolicy<span class="token punctuation">.</span>HttpVerb<span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">,</span> <span class="token string">'tenants/'</span> <span class="token operator">+</span> parts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        policy<span class="token punctuation">.</span><span class="token function">allowMethod</span><span class="token punctuation">(</span>AuthPolicy<span class="token punctuation">.</span>HttpVerb<span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">,</span> <span class="token string">'tenants/'</span> <span class="token operator">+</span> parts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'/domains'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        policy<span class="token punctuation">.</span><span class="token function">allowMethod</span><span class="token punctuation">(</span>AuthPolicy<span class="token punctuation">.</span>HttpVerb<span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">,</span> <span class="token string">'tenants/'</span> <span class="token operator">+</span> parts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'/domains/*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        policy<span class="token punctuation">.</span><span class="token function">allowMethod</span><span class="token punctuation">(</span>AuthPolicy<span class="token punctuation">.</span>HttpVerb<span class="token punctuation">.</span><span class="token constant">PUT</span><span class="token punctuation">,</span> <span class="token string">'tenants/'</span> <span class="token operator">+</span> parts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'/admins/*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// Assign Tenant Admins</span>
        policy<span class="token punctuation">.</span><span class="token function">allowMethod</span><span class="token punctuation">(</span>AuthPolicy<span class="token punctuation">.</span>HttpVerb<span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">,</span> <span class="token string">'tenants/'</span> <span class="token operator">+</span> parts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'/domains'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// Register Tenant Domains</span>
        policy<span class="token punctuation">.</span><span class="token function">allowMethod</span><span class="token punctuation">(</span>AuthPolicy<span class="token punctuation">.</span>HttpVerb<span class="token punctuation">.</span><span class="token constant">PUT</span><span class="token punctuation">,</span> <span class="token string">'tenants/'</span> <span class="token operator">+</span> parts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'/domains/*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Verify Tenant Domains</span>
        policy<span class="token punctuation">.</span><span class="token function">allowMethod</span><span class="token punctuation">(</span>AuthPolicy<span class="token punctuation">.</span>HttpVerb<span class="token punctuation">.</span><span class="token constant">DELETE</span><span class="token punctuation">,</span><span class="token string">'tenants/'</span> <span class="token operator">+</span> parts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'/domains/*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// De-register Tenant Domains</span>
        policy<span class="token punctuation">.</span><span class="token function">allowMethod</span><span class="token punctuation">(</span>AuthPolicy<span class="token punctuation">.</span>HttpVerb<span class="token punctuation">.</span><span class="token constant">PUT</span><span class="token punctuation">,</span> <span class="token string">'tenants/'</span> <span class="token operator">+</span> parts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'/apps/*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// Assign all tenant users to app</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <h2 id="next-steps"><a href="#next-steps" class="header-anchor">#</a> Next Steps</h2> <p>If you're ready to test out the sample project(s), head over to the <a href="/setup/">Setup</a> section to get started.</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/19/2020, 5:49:34 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/guide/architecture.html" class="prev">
        Architecture
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.450515ec.js" defer></script><script src="/assets/js/2.7119a548.js" defer></script><script src="/assets/js/11.2e3204a8.js" defer></script>
  </body>
</html>
